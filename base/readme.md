# 扫雷算法工具箱
- 史上首款扫雷算法工具箱。
- 文档见[https://docs.rs/ms_toollib](https://docs.rs/ms_toollib)。


## 史上第二款开源录像文件格式emv白皮书

从avf到rmv，扫雷录像的文件格式在技术层面上已经成熟。Arbiter、Viennasweeper等专业复刻版本可以轻松地记录并播放录像。假如用X代表某个复刻版本，这就意味着可以做到以下三件事情：第一，可以使用X生成X格式的录像；第二，可以用X、Y、Z……播放X格式的录像；第三，可以用X验证X格式的录像。但有一件事无法做到，那就是用Y、Z……复刻版本生成可供X播放的录像。目前，由于开发人员退圈，对这些文件的解析均依赖逆向，开发人员无法安全、自由地在各种格式之间转换。

特点：
- 对于计算机，编码、解码方便。不同于RAWVF格式，开发人员否认计算机易读和人类易读可以兼顾。
- 格式不设计混淆。使用校验码。
- 相比目前最流行的avf格式，evf是高精度的。精度保留至毫秒。
- 字符串采用utf-8编码。
- 方格尺寸可调，为屏幕显示的真实尺寸。
- 最早从游戏开始前、影响游戏的右键开始记录录像。
- 具有易读、无歧义的白皮书（文档），还有一个勤劳的作者。没有不为人知的细节、没有后门。  

后缀：evf（eee555's minesweeper video format）  

格式说明：  

- 定长1字节：版本号，本白皮书所述版本为'\0'。  
- 定长1字节：在高信任的场景下，降低解析的复杂度。  
         定长1比特：是否扫完: 软件证明这局是完成的，即没有踩雷、时间等所有数值没有溢出。其余条件一概不保证。  
         定长1比特：是否正式: 软件证明这局是正式的，包括没有用软件筛选3BV、没有看概率、是标准模式、时间等所有数值没有溢出。不一定包括是否满足排名网站对于3BV的额外限制。  
         定长1比特：是否公平完成: 软件证明这局是公平完成的，比如没有用软件筛选3BV、没有看概率、时间等所有数值没有溢出。公平完成和正式的区别是，只有标准游戏模式可以是正式的，而upk、无猜等模式不正式，但可以是公平完成的。如果是正式的，则一定是公平完成的。  
         剩余保留，根据成绩统计应用开发者的要求添加。
- 定长1字节：行数
- 定长1字节：列数
- 定长2字节：雷数，大端法。
- 定长1字节：方格尺寸
- 定长2字节：游戏模式（符号及含义：0->标准、1->upk；2->cheat；3->Density（来自Viennasweeper软件）、4->win7、5->竞速无猜、
         6->强无猜、7->弱无猜、8->准无猜、9->强可猜、10->弱可猜，剩余保留，根据新复刻版本开发者的要求添加），大端法。
- 定长2字节：3BV数值，大端法。
- 定长3字节：用时，单位毫秒，大端法。
- 以'\0'结尾字符串：录像的来源。如来自元扫雷3.x，则为"元3"。排名网站需要检查录像的来源。
- 以'\0'结尾字符串：用户标识（用户希望排名网站/软件在最显眼的位置展示出该标识）
- 以'\0'结尾字符串：比赛标识（用户希望使用该录像参与某比赛的凭证，但不希望排名网站/软件展示该标识）
- 以'\0'结尾字符串：唯一性标识（用户希望区别于其他同名用户，例如昵称、雷网id、省份、邮箱、网名、座右铭，但不希望排名网站/软件展示该标识）
- 以'\0'结尾字符串：开始时间戳，推荐采用格林威治时间自1970年1月1日至当前时间的总毫秒数。第一次在没有标雷的位置左键弹起的时间。
- 以'\0'结尾字符串：结束时间戳，推荐采用格林威治时间自1970年1月1日至当前时间的总毫秒数。
- 以'\0'结尾字符串：国家名称或代码。各软件可以不同。推荐采用ISO 3166-1标准国家代码的二位字母编码（大写）。
- 变长⌈行数×列数/8⌉字节：1代表是雷，0代表不是雷。第***i × 列数 + j***个比特，代表局面第*i*(从0开始)行、*j*(从0开始)列是否为雷。例如：下述3行、4列的局面（用*代表雷）：  
        [[1, 3, &ast;, &ast;],  
         [3, &ast;, &ast;, &ast;],  
         [&ast;, &ast;, &ast;, &ast;]]就记录为00110111 11110000。  
- 鼠标事件格式：
- 定长1字节：操作类型。1："mv"；2："lc"；3："lr"；4："rc"；5："rr"；6："mc";7："mr"，8: "pf"剩余保留(除'\0'、'\255')。
- 定长3字节：时间戳，单位毫秒。从第一次对局面有影响的右键按下开始记录为0，此后递增。也就是说，第一次在没有标雷的位置左键弹起的时间戳不一定为0，且最后一个操作的时间戳大于等于实际用时。大端法。
- 定长2字节：与左边线的距离，单位为像素。局面外的操作的坐标均记录为(行数×方格尺寸, 列数×方格尺寸)。大端法。
- 定长2字节：与上边线的距离，单位为像素。局面外的操作的坐标均记录为(行数×方格尺寸, 列数×方格尺寸)。大端法。
- 定长1字节：'\0'表示有校验码（软件直接生成的录像）；'\255'表示无校验码（例如是从avf等录像转译过来的）。
- 定长32字节：效验码，可有可无。



